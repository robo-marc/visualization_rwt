function toggleAllTable(a){if(a.hasClass("collapse")||a.hasClass("expand")){var b=function(a,c){var d=$("."+a);c?d.addClass("collapsed"):d.toggleClass("collapsed");for(var e=0;e<d.length;e++){var f=d[e];c=$(f).hasClass("collapse")?"collapse":"",b($(f).attr("id"),c)}};a.toggleClass("collapse"),a.toggleClass("expand");var c="";a.hasClass("collapse")&&(c="collapse"),b(a.attr("id"),c)}}function showDialog(a){$("#dialog_header_title").text(a.fullName()),$("#dialog_full_name").text(a.fullName()),$("#dialog_component").text(a.name),$("#dialog_hardware").text(a.status.hardware_id),$("#dialog_level").text(a.status.levelString()),$("#dialog_message").text(a.status.message);for(var b in a.status.values)$("#table-type-4").append("<tr><th>"+b+"</th><td>"+a.status.values[b]+"</td></tr>");$("#status-dialog").removeClass("dialog_hidden")}ROSLIB.DiagnosticsDirectory=function(a,b,c){"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=[]),this.parent=b,this.children=c,this.status=a.status,this.name=a.name},ROSLIB.DiagnosticsDirectory.prototype.findDirectory=function(a){if(this.name.toString()===a.toString())return this;if(0===this.children.length)return null;for(var b=0;b<this.children.length;b++){var c=this.children[b].findDirectory(a);if(null!==c)return c}return null},ROSLIB.DiagnosticsDirectory.prototype.addChild=function(a){this.children.push(a),a.parent=this},ROSLIB.DiagnosticsDirectory.prototype.createChild=function(a){var b=new ROSLIB.DiagnosticsDirectory({name:a},this);return this.addChild(b),b},ROSLIB.DiagnosticsDirectory.prototype.registerStatus=function(a){return this.status=a,a},ROSLIB.DiagnosticsDirectory.prototype.isChildrenHasError=function(){if(this.isErrorStatus())return this;for(var a=0;a<this.children.length;a++){var b=this.children[a].isChildrenHasError();if(b)return b}},ROSLIB.DiagnosticsDirectory.prototype.isErrorStatus=function(){return this.status?this.status.isERROR():!1},ROSLIB.DiagnosticsDirectory.prototype.fullName=function(){var a=function(b){if(null===b.parent)return"";var c=a(b.parent);return c+"/"+b.name};return a(this)},ROSLIB.DiagnosticsDirectory.prototype.uniqID=function(){var a=function(b){if(null===b.parent)return"";var c=a(b.parent);return 0===c.length?b.name:c+"-"+b.name};return a(this).replace(" ","-").replace("(","").replace(")","").replace("	","-")},ROSLIB.DiagnosticsDirectory.prototype.getAllDirectoriesWithoutRoot=function(){var a=this,b=a.getAllDirectories();return _.remove(b,function(b){return b===a}),b},ROSLIB.DiagnosticsDirectory.prototype.getAllDirectories=function(){var a=function(b){if(0===b.children.length)return[b];for(var c=[],d=0;d<b.children.length;d++){var e=a(b.children[d]);c=c.concat(e)}return c.push(b),c};return a(this)},ROSLIB.DiagnosticsDirectory.prototype.getDirectories=function(a){var b=function(c){if(0===c.children.length)return c.status&&c.status.level===a?[c]:[];for(var d=[],e=0;e<c.children.length;e++){var f=b(c.children[e]);d=d.concat(f)}return c.status&&c.status.level===a&&d.push(c),d};return b(this)},ROSLIB.DiagnosticsDirectory.prototype.getErrorDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.ERROR)},ROSLIB.DiagnosticsDirectory.prototype.getWarnDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.WARN)},ROSLIB.DiagnosticsDirectory.prototype.getOkDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.OK)},ROSLIB.DiagnosticsDirectory.prototype.findByName=function(a){if(this.status&&this.status.name.toString()===a.toString())return this;for(var b=0;b<this.children.length;b++){var c=this.children[b].findByName(a);if(c)return c}return null},ROSLIB.DiagnosticsDirectory.prototype.getIcon=function(){switch(this.status.level){case ROSLIB.DiagnosticsStatus.LEVEL.OK:return"ok";case ROSLIB.DiagnosticsStatus.LEVEL.WARN:return"warn";case ROSLIB.DiagnosticsStatus.LEVEL.ERROR:return"error";case ROSLIB.DiagnosticsStatus.LEVEL.STALE:return"stale"}},ROSLIB.DiagnosticsDirectory.prototype.hasChildren=function(){return 0!==this.children.length},ROSLIB.DiagnosticsHistory=function(a){"undefined"==typeof a&&(a={}),this.root=new ROSLIB.DiagnosticsDirectory({name:"root"})},ROSLIB.DiagnosticsHistory.prototype.registerStatus=function(a){for(var b=this.root,c=0;c<a.path.length;c++){var d=b.findDirectory(a.path[c]);null===d&&(d=b.createChild(a.path[c])),b=d}return b.registerStatus(a),b},ROSLIB.DiagnosticsStatus=function(a){"undefined"==typeof a&&(a={}),this.name=a.name,this.message=a.message,this.level=a.level,this.hardware_id=a.hardware_id,this.values={},this.stamp=a.timestamp;for(var b=0;b<a.values.length;b++)this.values[a.values[b].key]=a.values[b].value;this.path=_.filter(this.name.split("/"),function(a){return a.toString()!=="".toString()})},ROSLIB.DiagnosticsStatus.LEVEL={OK:0,WARN:1,ERROR:2,STALE:3},ROSLIB.DiagnosticsStatus.prototype.isOK=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.OK},ROSLIB.DiagnosticsStatus.prototype.isWARN=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.WARN},ROSLIB.DiagnosticsStatus.prototype.isERROR=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.ERROR},ROSLIB.DiagnosticsStatus.prototype.isSTALE=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.STALE},ROSLIB.DiagnosticsStatus.createFromArray=function(a){var b=a.header,c=ROSLIB.Time.fromROSMsg(b);return _.map(a.status,function(a){return new ROSLIB.DiagnosticsStatus({timestamp:c,name:a.name,message:a.message,hardware_id:a.hardware_id,level:a.level,values:a.values})})},ROSLIB.DiagnosticsStatus.prototype.levelString=function(){return this.isSTALE()?"STALE":this.isERROR()?"ERROR":this.isWARN()?"WARNING":this.isOK()?"OK":void 0},ROSLIB.RingBuffer=function(a){this.bufferCount=(a||{}).bufferCount||30,this.clear()},ROSLIB.RingBuffer.prototype.push=function(a){return this.endIndex++,this.endIndex===this.bufferCount&&(this.endIndex=0),this.count>=this.bufferCount?(this.buffer[this.endIndex]=a,this.startIndex++,this.startIndex===this.bufferCount&&(this.startIndex=0)):this.buffer[this.endIndex]=a,this.count++,a},ROSLIB.RingBuffer.prototype.clear=function(){this.buffer=new Array(this.bufferCount),this.startIndex=0,this.endIndex=-1,this.count=0},ROSLIB.RingBuffer.prototype.map=function(a){for(var b=[],c=this.startIndex;c<Math.min(this.count,this.bufferCount);c++)b.push(a.call(this,this.buffer[c]));if(this.count>this.bufferCount)for(var d=0;d<this.endIndex+1;d++)b.push(a.call(this,this.buffer[d]));return b},ROSLIB.RingBuffer.prototype.toArray=function(){return this.map(function(a){return a})},ROSLIB.RingBuffer.prototype.length=function(){return Math.min(this.bufferCount,this.count)};var arrData=[],maxData=30,dialogDataName="",allTableInit=!0;ROSLIB.RWTRobotMonitor=function(a){var b=a.diagnostics_agg_topic||"/diagnostics_agg",c=a.ros;this.last_diagnostics_update=null,this.last_time_id=a.last_time_id,this.is_paused=!1,this.maxData=a.maxData||30,this.clearData(),this.history=new ROSLIB.DiagnosticsHistory(a),this.diagnostics_agg_subscriber=new ROSLIB.Topic({ros:c,name:b,messageType:"diagnostic_msgs/DiagnosticArray"});var d=this;this.diagnostics_agg_subscriber.subscribe(function(a){d.diagnosticsCallback(a),d.addData(a)}),setTimeout(function(){d.updateLastTimeString()},1e3),$("#pause-button").show(),$("#start-button").hide()},ROSLIB.RWTRobotMonitor.prototype.diagnosticsCallback=function(a){if(this.last_diagnostics_update=ROSLIB.Time.now(),!this.is_paused){var b=ROSLIB.DiagnosticsStatus.createFromArray(a),c=this;_.forEach(b,function(a){c.history.registerStatus(a)});var d=!1;this.updateView(d)}},ROSLIB.RWTRobotMonitor.prototype.showHistory=function(a){this.history=new ROSLIB.DiagnosticsHistory;var b=ROSLIB.DiagnosticsStatus.createFromArray(a),c=this;_.forEach(b,function(a){c.history.registerStatus(a)}),this.updateView(history)},ROSLIB.RWTRobotMonitor.prototype.updateLastTimeString=function(){var a=this;if(a.last_diagnostics_update){var b=ROSLIB.Time.now(),c=b.substract(a.last_diagnostics_update).toSec();$(a.last_time_id).html(Math.floor(c))}else $(a.last_time_id).html(-1);setTimeout(function(){a.updateLastTimeString()},1e3)},ROSLIB.RWTRobotMonitor.prototype.updateView=function(a){var b=this.updateErrorList(),c=this.updateWarnList(),d=this.checkStale();this.updateAllTable(),a||this.updateTimeList(b,c,d),this.registerBrowserCallback()},ROSLIB.RWTRobotMonitor.prototype.updateTable=function(a,b,c){$("#"+a+" tr:gt(0)").remove();var d=this.history.root.getDirectories(c);return d.sort(function(a,b){var c=a.fullName(),d=b.fullName();return c>d?1:d>c?-1:0}),_.forEach(d,function(c){var d='<tr class="'+b+'"><td class="data_1" data-name="'+c.fullName()+'">'+c.fullName()+'</td><td class="data_2">'+c.status.message+"</td></tr>";$("#"+a).append(d)}),d.length?!0:!1},ROSLIB.RWTRobotMonitor.prototype.updateAllTable=function(){var a=[];$("#all-table .collapse").each(function(){a.push($(this).attr("id"))}),$("#all-table tr:gt(0)").remove();for(var b=function(c,d,e,f,g){var h=" leaf leaf"+d,i="",j="";if(0!==c.children.length){if(allTableInit)i=" collapse";else for(var k=0;k<a.length;k++)if(a[k].toString()===c.uniqID().toString()){i=" collapse";break}""===i&&(i=" expand")}e&&" collapse"===f?j=" collapsed":e&&" collapsed"===g&&(j=" collapsed");var l=$('<tr id="'+c.uniqID()+'" class="'+e+" "+c.getIcon()+h+i+j+'"><td class="data_1" data-name="'+c.fullName()+'"><div class="toggle-button"></div><span>'+c.name+'</span></td><td class="data_2">'+c.status.message+"</td></tr>");if(0===c.children.length)return l;d++;for(var m=0;m<c.children.length;m++){var n=c.children[m],o=b(n,d,c.uniqID(),i,j);l.after(o)}return l},c=0;c<this.history.root.children.length;c++){var d=b(this.history.root.children[c],0,"");$("#all-table").append(d)}allTableInit=!1},ROSLIB.RWTRobotMonitor.prototype.updateWarnList=function(){var a=this.updateTable("warn-table","warn",ROSLIB.DiagnosticsStatus.LEVEL.WARN);return a},ROSLIB.RWTRobotMonitor.prototype.updateErrorList=function(){var a=this.updateTable("error-table","error",ROSLIB.DiagnosticsStatus.LEVEL.ERROR);return a},ROSLIB.RWTRobotMonitor.prototype.checkStale=function(){var a=this.updateTable("stale-table","stale",ROSLIB.DiagnosticsStatus.LEVEL.STALE);return a},ROSLIB.RWTRobotMonitor.prototype.updateTimeList=function(a,b,c){for(var d=document.getElementById("btn0"),e=0,f=this.maxData-2;f>=0;f--)switch(d=document.getElementById("btn"+f.toString()),e=f+1,d.className){case"time-item error":d=document.getElementById("btn"+e.toString()),d.className="time-item error";break;case"time-item warn":d=document.getElementById("btn"+e.toString()),d.className="time-item warn";break;case"time-item ok":d=document.getElementById("btn"+e.toString()),d.className="time-item ok";break;case"time-item stale":d=document.getElementById("btn"+e.toString()),d.className="time-item stale"}d=document.getElementById("btn0"),a?d.className="time-item error":b?d.className="time-item warn":c?d.className="time-item stale":d.className="time-item ok"},ROSLIB.RWTRobotMonitor.prototype.registerBrowserCallback=function(){var a=this.history.root;if(!$("#status-dialog").hasClass("dialog_hidden")){$("#table-type-4").empty();var b=a.findByName(dialogDataName);showDialog(b)}},ROSLIB.RWTRobotMonitor.prototype.clearData=function(){this.data=new ROSLIB.RingBuffer({bufferCount:this.maxData})},ROSLIB.RWTRobotMonitor.prototype.addData=function(a){if(!this.is_paused){var b=_.isArray(a)?a.length:0;0===b&&(a=[a]),this.data.push(a),arrData=this.data.toArray()}};