ROSLIB.DiagnosticsDirectory=function(a,b,c){"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=[]),this.parent=b,this.children=c,this.status=a.status,this.name=a.name},ROSLIB.DiagnosticsDirectory.prototype.findDirectory=function(a){if(this.name.toString()===a.toString())return this;if(0===this.children.length)return null;for(var b=0;b<this.children.length;b++){var c=this.children[b].findDirectory(a);if(null!==c)return c}return null},ROSLIB.DiagnosticsDirectory.prototype.addChild=function(a){this.children.push(a),a.parent=this},ROSLIB.DiagnosticsDirectory.prototype.createChild=function(a){var b=new ROSLIB.DiagnosticsDirectory({name:a},this);return this.addChild(b),b},ROSLIB.DiagnosticsDirectory.prototype.registerStatus=function(a){return this.status=a,a},ROSLIB.DiagnosticsDirectory.prototype.isChildrenHasError=function(){if(this.isErrorStatus())return this;for(var a=0;a<this.children.length;a++){var b=this.children[a].isChildrenHasError();if(b)return b}},ROSLIB.DiagnosticsDirectory.prototype.isErrorStatus=function(){return this.status?this.status.isERROR():!1},ROSLIB.DiagnosticsDirectory.prototype.fullName=function(){var a=function(b){if(null===b.parent)return"";var c=a(b.parent);return c+"/"+b.name};return a(this)},ROSLIB.DiagnosticsDirectory.prototype.uniqID=function(){var a=function(b){if(null===b.parent)return"";var c=a(b.parent);return 0===c.length?b.name:c+"-"+b.name};return a(this).replace(" ","-").replace("(","").replace(")","").replace("	","-")},ROSLIB.DiagnosticsDirectory.prototype.getAllDirectoriesWithoutRoot=function(){var a=this,b=a.getAllDirectories();return _.remove(b,function(b){return b===a}),b},ROSLIB.DiagnosticsDirectory.prototype.getAllDirectories=function(){var a=function(b){if(0===b.children.length)return[b];for(var c=[],d=0;d<b.children.length;d++){var e=a(b.children[d]);c=c.concat(e)}return c.push(b),c};return a(this)},ROSLIB.DiagnosticsDirectory.prototype.getDirectories=function(a){var b=function(c){if(0===c.children.length)return c.status&&c.status.level===a?[c]:[];for(var d=[],e=0;e<c.children.length;e++){var f=b(c.children[e]);d=d.concat(f)}return c.status&&c.status.level===a&&d.push(c),d};return b(this)},ROSLIB.DiagnosticsDirectory.prototype.getErrorDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.ERROR)},ROSLIB.DiagnosticsDirectory.prototype.getWarnDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.WARN)},ROSLIB.DiagnosticsDirectory.prototype.getOkDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.OK)},ROSLIB.DiagnosticsDirectory.prototype.findByName=function(a){if(this.status&&this.status.name.toString()===a.toString())return this;for(var b=0;b<this.children.length;b++){var c=this.children[b].findByName(a);if(c)return c}return null},ROSLIB.DiagnosticsDirectory.prototype.getIconHTML=function(){return this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.OK?'<span class="glyphicon-ok glyphicon"></span>':this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.WARN?'<span class="glyphicon-exclamation-sign glyphicon"></span>':this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.ERROR?'<span class="glyphicon-minus-sign glyphicon"></span>':void 0},ROSLIB.DiagnosticsDirectory.prototype.getIconHTML2=function(){return this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.OK?"ok":this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.WARN?"warn":this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.ERROR?"error":void 0},ROSLIB.DiagnosticsDirectory.prototype.getCollapseIconHTML=function(){return 0!==this.children.length?'<span class="glyphicon-chevron-right glyphicon"></span>':""},ROSLIB.DiagnosticsDirectory.prototype.getCollapseIconHTML2=function(){return 0!==this.children.length?'<span class="glyphicon-chevron-right glyphicon"></span>':""},ROSLIB.DiagnosticsDirectory.prototype.hasChildren=function(){return 0!==this.children.length},ROSLIB.DiagnosticsHistory=function(a){"undefined"==typeof a&&(a={}),this.root=new ROSLIB.DiagnosticsDirectory({name:"root"})},ROSLIB.DiagnosticsHistory.prototype.registerStatus=function(a){for(var b=this.root,c=0;c<a.path.length;c++){var d=b.findDirectory(a.path[c]);null===d&&(d=b.createChild(a.path[c])),b=d}return b.registerStatus(a),b},ROSLIB.DiagnosticsStatus=function(a){"undefined"==typeof a&&(a={}),this.name=a.name,this.message=a.message,this.level=a.level,this.hardware_id=a.hardware_id,this.values={},this.stamp=a.timestamp;for(var b=0;b<a.values.length;b++)this.values[a.values[b].key]=a.values[b].value;this.path=_.filter(this.name.split("/"),function(a){return a.toString()!=="".toString()})},ROSLIB.DiagnosticsStatus.LEVEL={OK:0,WARN:1,ERROR:2},ROSLIB.DiagnosticsStatus.prototype.isOK=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.OK},ROSLIB.DiagnosticsStatus.prototype.isWARN=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.WARN},ROSLIB.DiagnosticsStatus.prototype.isERROR=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.ERROR},ROSLIB.DiagnosticsStatus.createFromArray=function(a){var b=a.header,c=ROSLIB.Time.fromROSMsg(b);return _.map(a.status,function(a){return new ROSLIB.DiagnosticsStatus({timestamp:c,name:a.name,message:a.message,hardware_id:a.hardware_id,level:a.level,values:a.values})})},ROSLIB.DiagnosticsStatus.prototype.levelString=function(){return this.isERROR()?"ERROR":this.isWARN()?"WARNING":this.isOK()?"OK":void 0};var arrData=[],maxData=30;$("#status-dialog").hide(),ROSLIB.RWTRobotMonitor=function(a){var b=a.diagnostics_agg_topic||"/diagnostics_agg",c=a.ros;this.last_diagnostics_update=null,this.last_time_id=a.last_time_id,this.maxData=a.maxData||30,this.clearData(),this.history=new ROSLIB.DiagnosticsHistory(a),this.diagnostics_agg_subscriber=new ROSLIB.Topic({ros:c,name:b,messageType:"diagnostic_msgs/DiagnosticArray"});var d=this;this.diagnostics_agg_subscriber.subscribe(function(a){d.diagnosticsCallback(a),d.addData(a)}),setTimeout(function(){d.updateLastTimeString()},1e3),$("#pause-button").show(),$("#start-button").hide()},ROSLIB.RWTRobotMonitor.prototype.diagnosticsCallback=function(a){if(this.last_diagnostics_update=ROSLIB.Time.now(),!ROSLIB.RWTRobotMonitor.prototype.is_paused){var b=ROSLIB.DiagnosticsStatus.createFromArray(a),c=this;_.forEach(b,function(a){c.history.registerStatus(a)});var d=!1;this.updateView(d)}},ROSLIB.RWTRobotMonitor.prototype.showHistory=function(a){var b=!0;this.last_diagnostics_update=ROSLIB.Time.now(),this.history=new ROSLIB.DiagnosticsHistory;var c=ROSLIB.DiagnosticsStatus.createFromArray(a),d=this;_.forEach(c,function(a){d.history.registerStatus(a)}),this.updateView(b)},ROSLIB.RWTRobotMonitor.prototype.updateLastTimeString=function(){var a=this;if(a.last_diagnostics_update){var b=ROSLIB.Time.now(),c=b.substract(a.last_diagnostics_update).toSec();$(a.last_time_id).html(Math.floor(c))}else $(a.last_time_id).html(-1);setTimeout(function(){a.updateLastTimeString()},1e3)},ROSLIB.RWTRobotMonitor.prototype.updateView=function(a){var b=this.updateErrorList(),c=this.updateWarnList();this.updateAllTable(),a||this.updateTimeList(b,c),this.registerBrowserCallback()},ROSLIB.RWTRobotMonitor.prototype.updateTable=function(a,b,c){$("#"+a+" tr:gt(0)").remove(),$("#"+a+" tr:gt(0)").size();var d=this.history.root.getDirectories(c);return d.sort(function(a,b){var c=a.fullName(),d=b.fullName();return c>d?1:d>c?-1:0}),_.forEach(d,function(c){var d='<tr class="'+b+'"><td class="data_1" data-name="'+c.fullName()+'">'+c.fullName()+'</td><td class="data_2">'+c.status.message+"</td></tr>";$("#"+a).append(d)}),d.length?!0:!1},ROSLIB.RWTRobotMonitor.prototype.updateAllTable=function(){var a=[];console.log("----- #all-table ----"),console.log($("#all-table")),$("#all-table .collapse").each(function(){a.push($(this).attr("id"))}),console.log("----- allTable open_ids ----"),console.log(a),$("#all-table tr:gt(0)").remove(),$("#all-table tr:gt(0)").size();for(var b=function(c,d,e){var f=" leaf leaf"+d,g="";0===c.children.length||(g=" expand");var h=$('<tr id="'+c.uniqID()+'" class="'+e+" "+c.getIconHTML2()+f+g+'"><td class="data_1" data-name="'+c.fullName()+'"><span>'+c.name+'</span></td><td class="data_2">'+c.status.message+"</td></tr>");if(console.log("----- allTableTree_1 ----"),console.log(h),0===c.children.length)return h;for(var i=0;i<a.length;i++);d++;for(var j=0;j<c.children.length;j++){var k=c.children[j],l=b(k,d,c.uniqID());h.after(l)}return console.log("----- allTableTree ----"),console.log(h),h},c=0;c<this.history.root.children.length;c++){var d=b(this.history.root.children[c],0,"");console.log("----- allTable ----"),console.log(d),$("#all-table").append(d)}for(var e=0;e<a.length;e++){var f="."+a[e];console.log("----- parentId ----"),console.log(f),$(f).slideToggle(1)}$(".robot-joy").slideToggle(1),$(".robot-dummy2").slideToggle(1),$(".robot-dummy").slideToggle(1),$(".robot").slideToggle(1)},ROSLIB.RWTRobotMonitor.prototype.updateAllList=function(){console.log("----- #all-list ----"),console.log($("#all-list"));var a=[];$("#all-list .in, #all-list .collapsing").each(function(){a.push($(this).attr("id"))}),console.log("----- open_ids ----"),console.log(a),$("#all-list li").remove();for(var b=function(c){console.log("----- directory ----"),console.log(c);var d=$('<li class="list-group-item inner" data-name="'+c.fullName()+'"><a data-toggle="collapse" data-parent="#all-list" href="#'+c.uniqID()+'">'+c.getCollapseIconHTML()+c.getIconHTML()+c.name+"</a></li>");if(0===c.children.length)return console.log("----- All list $html ----"),console.log(d),d;for(var e=$('<ul class="list-group-item-content collapse no-transition" id="'+c.uniqID()+'"></ul>'),f=0;f<a.length;f++)if(a[f].toString()===c.uniqID().toString()){e.addClass("in");break}for(var g=0;g<c.children.length;g++){var h=c.children[g],i=b(h);e.append(i)}return d.append(e),console.log("----- div_root ----"),console.log(e),d},c=0;c<this.history.root.children.length;c++){var d=b(this.history.root.children[c]);$("#all-list").append(d),console.log("----- All list Root $html ----"),console.log(d)}},ROSLIB.RWTRobotMonitor.prototype.updateWarnList=function(){var a=this.updateTable("warn-table","warn",ROSLIB.DiagnosticsStatus.LEVEL.WARN);return a},ROSLIB.RWTRobotMonitor.prototype.updateErrorList=function(){var a=this.updateTable("error-table","error",ROSLIB.DiagnosticsStatus.LEVEL.ERROR);return a},ROSLIB.RWTRobotMonitor.prototype.updateTimeList=function(a,b){for(var c=document.getElementById("btn0"),d=0,e=this.maxData-2;e>=0;e--)switch(c=document.getElementById("btn"+e.toString()),d=e+1,c.className){case"time-item error":c=document.getElementById("btn"+d.toString()),c.className="time-item error";break;case"time-item warn":c=document.getElementById("btn"+d.toString()),c.className="time-item warn";break;case"time-item ok":c=document.getElementById("btn"+d.toString()),c.className="time-item ok"}c=document.getElementById("btn0"),a?c.className="time-item error":b?c.className="time-item warn":c.className="time-item ok"},ROSLIB.RWTRobotMonitor.prototype.registerBrowserCallback=function(){var a=this.history.root;$(".data_1").on("dblclick",function(){var b=a.findByName($(this).attr("data-name"));$("#dialog_header_title").text(b.fullName()),$("#dialog_full_name").text(b.fullName()),$("#dialog_component").text(b.name),$("#dialog_hardware").text(b.status.hardware_id),$("#dialog_level").text(b.status.levelString()),$("#dialog_message").text(b.status.message);for(var c in b.status.values)$("#table-type-4").append("<tr><th>"+c+"</th><td>"+b.status.values[c]+"</td></tr>");$("#status-dialog").show()}),$("#close").on("click",function(){$("#status-dialog").hide(),$("#table-type-4").empty()}),$(".expand").on("click",function(){var a=function(a){var b="."+$(a).attr("id");console.log("----- parentId ----"),console.log(b),console.log("----- parent ----"),console.log(a),console.log("----- ($(parent) ----"),console.log($(a)),$(a).toggleClass("collapse"),$(b).slideToggle(1)},b=a(this);console.log(b)}),$(".collapse").on("click",function(){})},ROSLIB.RWTRobotMonitor.prototype.clearData=function(){this.data=new ROSLIB.RingBuffer({bufferCount:this.maxData})},ROSLIB.RWTRobotMonitor.prototype.addData=function(a){if(!ROSLIB.RWTRobotMonitor.prototype.is_paused){var b=_.isArray(a)?a.length:0;0===b&&(a=[a]),this.data.push(a),arrData=this.data.toArray()}},ROSLIB.RingBuffer=function(a){this.bufferCount=(a||{}).bufferCount||30,this.clear()},ROSLIB.RingBuffer.prototype.push=function(a){return this.endIndex++,this.endIndex===this.bufferCount&&(this.endIndex=0),this.count>=this.bufferCount?(this.buffer[this.endIndex]=a,this.startIndex++,this.startIndex===this.bufferCount&&(this.startIndex=0)):this.buffer[this.endIndex]=a,this.count++,a},ROSLIB.RingBuffer.prototype.clear=function(){this.buffer=new Array(this.bufferCount),this.startIndex=0,this.endIndex=-1,this.count=0},ROSLIB.RingBuffer.prototype.map=function(a){for(var b=[],c=this.startIndex;c<Math.min(this.count,this.bufferCount);c++)b.push(a.call(this,this.buffer[c]));if(this.count>this.bufferCount)for(var d=0;d<this.endIndex+1;d++)b.push(a.call(this,this.buffer[d]));return b},ROSLIB.RingBuffer.prototype.toArray=function(){return this.map(function(a){return a})},ROSLIB.RingBuffer.prototype.length=function(){return Math.min(this.bufferCount,this.count)};var timeListClick=function(a){ROSLIB.RWTRobotMonitor.prototype.is_paused=!0,$("#pause-button").hide(),$("#start-button").show();var b=a.data.name.substr(3),c={};c=arrData[Math.abs(parseInt(b,10)-(arrData.length-1))];var d=c[0];ROSLIB.RWTRobotMonitor.prototype.showHistory(d)};$("#pause-button").on("click",function(a){a.preventDefault(),ROSLIB.RWTRobotMonitor.prototype.is_paused=!0,$("#pause-button").hide(),$("#start-button").show()}),$("#start-button").on("click",function(a){a.preventDefault(),ROSLIB.RWTRobotMonitor.prototype.is_paused=!1,$("#pause-button").show(),$("#start-button").hide()}),$("#btn0").on("click",{name:"btn0"},timeListClick),$("#btn1").on("click",{name:"btn1"},timeListClick),$("#btn2").on("click",{name:"btn2"},timeListClick),$("#btn3").on("click",{name:"btn3"},timeListClick),$("#btn4").on("click",{name:"btn4"},timeListClick),$("#btn5").on("click",{name:"btn5"},timeListClick),$("#btn6").on("click",{name:"btn6"},timeListClick),$("#btn7").on("click",{name:"btn7"},timeListClick),$("#btn8").on("click",{name:"btn8"},timeListClick),$("#btn9").on("click",{name:"btn9"},timeListClick),$("#btn10").on("click",{name:"btn10"},timeListClick),$("#btn11").on("click",{name:"btn11"},timeListClick),$("#btn12").on("click",{name:"btn12"},timeListClick),$("#btn13").on("click",{name:"btn13"},timeListClick),$("#btn14").on("click",{name:"btn14"},timeListClick),$("#btn15").on("click",{name:"btn15"},timeListClick),$("#btn16").on("click",{name:"btn16"},timeListClick),$("#btn17").on("click",{name:"btn17"},timeListClick),$("#btn18").on("click",{name:"btn18"},timeListClick),$("#btn19").on("click",{name:"btn19"},timeListClick),$("#btn20").on("click",{name:"btn20"},timeListClick),$("#btn21").on("click",{name:"btn21"},timeListClick),$("#btn22").on("click",{name:"btn22"},timeListClick),$("#btn23").on("click",{name:"btn23"},timeListClick),$("#btn24").on("click",{name:"btn24"},timeListClick),$("#btn25").on("click",{name:"btn25"},timeListClick),$("#btn27").on("click",{name:"btn26"},timeListClick),$("#btn27").on("click",{name:"btn27"},timeListClick),$("#btn28").on("click",{name:"btn28"},timeListClick),$("#btn29").on("click",{name:"btn29"},timeListClick);